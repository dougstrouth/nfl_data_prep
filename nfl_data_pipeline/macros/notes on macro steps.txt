create a macro that makes a table called metadata_{schema_name} that is all column names in a given schema, cols should be schema, table, and column the macro should have an optional argument to exclude a list of tables and it should always exclude tables that start with metadata_
if the column is not a number data type then get a record count of the whole table called total_count added to the first table
create a second macro that makes a new table called distribution_{schema_name} that takes a given schema as an argument that gets the distinct values for each column by reading throught the metadata_{schema_name} table created by the first macro and count of each distinct item as column_count, make this a new table that has schema, table, column, value 1, column count etc going through each distinct value to generate a new row
join on table and column with the metadata_{schema_name} table created earlier via macro to then append to the distinct values table get pct which is distinct count divided by total count

create a final test statement that groups on schema and table name and sums the column_count column for each row of the distribution_{schema_name} tables and then joins on table and schema to the correct metadata_{schema_name} table and subtracts column_count from total_count as a column named diff and evaluates if it is zero for all rows in the table and returns "Tie out passed" if they are, otherwise output the rows where diff !=0